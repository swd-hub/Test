<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å¸‚å ´ãƒ‡ãƒ¼ã‚¿åˆ†æãƒ„ãƒ¼ãƒ«ï¼ˆå…¨å®Ÿæ•°ãƒ»å˜ä½ãªã—ãƒ»ç·åˆè¨ˆæœ€ä¸‹è¡Œï¼‰</title>
<style>
    body { font-family: "Helvetica Neue", Arial, sans-serif; padding: 20px; background-color: #f4f6f9; color: #333; }
    h1 { font-size: 1.4rem; margin-bottom: 10px; border-bottom: 2px solid #ddd; padding-bottom: 10px; }
    .container { max-width: 1500px; margin: 0 auto; background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    
    .header-top { 
        display: flex; 
        justify-content: space-between; 
        align-items: center; 
        margin-bottom: 20px;
        flex-wrap: wrap;
        gap: 15px;
    }
    .header-top h1 { margin: 0; flex: 1; }
    
    #sourceButton {
        padding: 10px 20px;
        background-color: #6c757d;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-weight: bold;
        font-size: 14px;
        text-decoration: none;
        display: inline-block;
        white-space: nowrap;
    }
    #sourceButton:hover { background-color: #5a6268; }
    
    .input-area { margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 20px; }
    textarea { width: 100%; height: 150px; padding: 10px; border: 1px solid #ccc; border-radius: 4px; font-family: monospace; font-size: 12px; }
    
    .controls { margin-top: 15px; display: flex; gap: 15px; align-items: center; background: #eef; padding: 15px; border-radius: 5px; flex-wrap: wrap; }
    input[type="text"], input[type="number"] { padding: 10px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px; }
    input[type="number"] { width: 80px; }
    button { padding: 10px 24px; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; }
    button:hover { background-color: #0056b3; }
    
    #errorMessage { color: red; font-weight: bold; margin-top: 10px; }
    
    .tables-container { display: flex; flex-direction: column; gap: 30px; }
    .gender-section h2 { background-color: #343a40; color: white; padding: 10px; margin: 0; font-size: 1.1rem; border-radius: 4px 4px 0 0; }
    
    table { width: 100%; border-collapse: collapse; font-size: 13px; background: white; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
    th { 
        background-color: #f8f9fa; 
        color: #333; 
        font-weight: bold; 
        cursor: pointer;
        user-select: none;
        position: relative;
    }
    th:hover { background-color: #e2e6ea; }
    th.sort-asc::after { content: " â–²"; color: #007bff; }
    th.sort-desc::after { content: " â–¼"; color: #007bff; }
    
    tr:nth-child(even) { background-color: #fcfcfc; }
    tr:hover { background-color: #f1f1f1; }
    
    .market-name-col { text-align: left; font-weight: bold; }
    .total-row { background-color: #e9ecef; font-weight: bold; }
    .total-row td { background-color: #e9ecef; }
    
    .data-value { font-weight: bold; font-size: 1.1em; color: #007bff; }
    .note { font-size: 0.9rem; color: #666; margin-bottom: 10px; }
</style>
</head>
<body>

<div class="container">
    <div class="header-top">
        <h1>ğŸ“Š å¸‚å ´ãƒ‡ãƒ¼ã‚¿åˆ†æãƒ„ãƒ¼ãƒ«ï¼ˆå…¨é …ç›® å®Ÿæ•°è¡¨ç¤ºãƒ»å˜ä½ãªã—ç‰ˆï¼‰</h1>
        <a id="sourceButton" href="https://www.alic.go.jp/operation/livestock/calf-report.html" target="_blank">è‚‰ç”¨å­ç‰›å–å¼•æƒ…å ±ã‚µã‚¤ãƒˆã¸</a>
    </div>
    <div class="tables-container">
    <p class="note">
        â€» **å…¨é …ç›®**ã§ã€**å®Ÿæ•°ï¼ˆå…ƒã®æ•°å€¤ï¼‰**ã‚’è¡¨ç¤ºã—ã¦ã„ã¾ã™ã€‚ã‚»ãƒ«å†…ã®**å˜ä½è¡¨è¨˜ã¯ã‚ã‚Šã¾ã›ã‚“**ã€‚<br>
        â€» ã‚½ãƒ¼ãƒˆã¯ã€**å–å¼•é ­æ•°**ã¯**æ˜‡é †ï¼ˆå°‘ãŒä¸Šï¼‰**ã€**ä¾¡æ ¼ãƒ»ä½“é‡ãƒ»æ—¥é½¢ãƒ»å˜ä¾¡**ã¯**é™é †ï¼ˆå¤šãŒä¸Šï¼‰**ãŒåˆæœŸè¨­å®šã§ã™ã€‚<br>
        â€» **ç·åˆè¨ˆ**è¡Œã¯å„è¡¨ã®**æœ€ä¸‹éƒ¨**ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
    </p>
    <div class="input-area">
        <textarea id="dataInput" placeholder="ã“ã“ã«Excelã‚„PDFã‹ã‚‰ã‚³ãƒ”ãƒ¼ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„..."></textarea>
        <div class="controls">
            <label>æŠ½å‡ºå¯¾è±¡å¹´: <input type="number" id="targetYear" value="2025" placeholder="ä¾‹: 2025"></label>
            <label>æŠ½å‡ºå¯¾è±¡æœˆ: <input type="number" id="targetMonth" value="8" placeholder="ä¾‹: 8"></label>
            <button onclick="processData()">ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ï¼†è¡¨ä½œæˆ</button>
        </div>
        <div id="errorMessage"></div>
    </div>

    <div id="resultArea" class="tables-container"></div>
</div>

<script>
let parsedDataByGender = { 'é›„': [], 'é›Œ': [], 'è¨ˆ': [] };
let marketMap = {};
let sortState = {
    'é›„': { key: null, dir: 'asc' },
    'é›Œ': { key: null, dir: 'asc' },
    'è¨ˆ': { key: null, dir: 'asc' }
};

const metricsMap = [
    { key: 'count', label: 'å–å¼•é ­æ•°', unit: 'é ­' },
    { key: 'price', label: 'å¹³å‡ä¾¡æ ¼', unit: 'å††' },
    { key: 'weight', label: 'å¹³å‡ä½“é‡', unit: 'kg' },
    { key: 'age', label: 'å¹³å‡æ—¥é½¢', unit: 'æ—¥' },
    { key: 'unitPrice', label: '1kgå˜ä¾¡', unit: 'å††' }
];

// å¸‚å ´åã‚’å«ã‚€è¡Œã®æ¤œå‡ºãƒ­ã‚¸ãƒƒã‚¯
function isMarketHeaderLine(line) {
    if (line.includes("ãƒšãƒ¼ã‚¸") || line.includes("æœˆåˆ¥è‚‰ç”¨å­ç‰›å–å¼•çŠ¶æ³è¡¨") || line.includes("éƒ½é“åºœçœŒ") || line.includes("ç·åˆè¨ˆ") || line.includes("å“ç¨®ï¼š")) return false;

    const prefs = ["åŒ—æµ·é“", "é’æ£®", "å²©æ‰‹", "å®®åŸ", "ç§‹ç”°", "å±±å½¢", "ç¦å³¶", "èŒ¨åŸ", "æ ƒæœ¨", "ç¾¤é¦¬", "åŸ¼ç‰", "åƒè‘‰", "æ±äº¬", "ç¥å¥ˆå·", "æ–°æ½Ÿ", "å¯Œå±±", "çŸ³å·", "ç¦äº•", "å±±æ¢¨", "é•·é‡", "å²é˜œ", "é™å²¡", "æ„›çŸ¥", "ä¸‰é‡", "æ»‹è³€", "äº¬éƒ½", "å¤§é˜ª", "å…µåº«", "å¥ˆè‰¯", "å’Œæ­Œå±±", "é³¥å–", "å³¶æ ¹", "å²¡å±±", "åºƒå³¶", "å±±å£", "å¾³å³¶", "é¦™å·", "æ„›åª›", "é«˜çŸ¥", "ç¦å²¡", "ä½è³€", "é•·å´", "ç†Šæœ¬", "å¤§åˆ†", "å®®å´", "é¹¿å…å³¶", "æ²–ç¸„"];
    
    const parts = line.split(/\t/).map(p => p.trim()).filter(p => p.length > 0);
    
    if (parts.length > 0) {
        const firstPart = parts[0];
        if (prefs.some(p => firstPart === p || (firstPart.length > 2 && firstPart.includes(p.substring(0, 2))))) {
            return true;
        }
    }
    
    return false;
}

// éƒ½é“åºœçœŒã¨å¸‚å ´åã‚’åˆ†é›¢ã—ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ã—ã¦è¿”ã™
function extractPrefAndMarket(line) {
    let parts = line.split(/\t/).map(p => p.trim()).filter(p => p.length > 0);
    
    if (parts.length < 2) {
        const rawName = parts[0] || '';
        return { prefecture: rawName, market: '' }; 
    }

    const prefecture = parts[0].replace(/ï¼Š|\*|ï¼|-/g, "").trim();
    let market = parts[1].replace(/ï¼Š|\*|ï¼|-/g, "").trim();
    
    if (market.includes("çœŒåˆè¨ˆ")) {
        return { prefecture: prefecture, market: 'çœŒåˆè¨ˆ' };
    }
    
    return { prefecture: prefecture, market: market };
}

// å¸‚å ´åã‹ã‚‰ã‚­ãƒ¼ã‚’ç”Ÿæˆ
function createMarketKey(pref, market) {
    if (pref === 'ç·åˆè¨ˆ') return 'ç·åˆè¨ˆ';
    return `${pref}_${market}`;
}


// ãƒ‡ãƒ¼ã‚¿ã®æŠ½å‡ºã¨æ ¼ç´ï¼ˆå‹ã®å³å¯†åŒ–ï¼‰
function extractAndStore(lineParts, dataStartIndexInLine, marketName, gender, metricKey) {
    const raw = lineParts[dataStartIndexInLine];

    if (raw === undefined || raw === null || raw === '') {
        return;
    }
    
    let cleaned = raw.replace(/,/g, '').replace(/[N\/A\*ï¼]/g, '').trim(); 

    if (cleaned === '') {
        return;
    }

    const num = parseFloat(cleaned);
    
    if (!isNaN(num)) {
        if (!marketMap[marketName][gender]) marketMap[marketName][gender] = {};
        // ã™ã¹ã¦å®Ÿæ•°ã‚’æ ¼ç´
        marketMap[marketName][gender][metricKey] = num;
        
    } else {
         // console.log(`å‹å¤‰æ›ã‚¨ãƒ©ãƒ¼: ${marketName} - ${gender} - ${metricKey} ã®å€¤ '${raw}' ã¯æ•°å€¤ã«ãƒ‘ãƒ¼ã‚¹ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚`);
    }
}


function processData() {
    const text = document.getElementById('dataInput').value;
    const targetMonth = document.getElementById('targetMonth').value.trim(); 
    const errorDiv = document.getElementById('errorMessage');
    const resultDiv = document.getElementById('resultArea');
    
    errorDiv.textContent = "";
    resultDiv.innerHTML = "";
    parsedDataByGender = { 'é›„': [], 'é›Œ': [], 'è¨ˆ': [] };
    marketMap = {};
    sortState = {
        'é›„': { key: null, dir: 'asc' },
        'é›Œ': { key: null, dir: 'asc' },
        'è¨ˆ': { key: null, dir: 'asc' }
    };

    if (!text) {
        errorDiv.textContent = "ãƒ‡ãƒ¼ã‚¿ã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ã€‚";
        return;
    }

    const lines = text.split('\n').map(line => line.trim()).filter(line => line.length > 0);
    
    // 1. ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œã‚’æ¢ã—ã¦å¯¾è±¡æœˆã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’ç‰¹å®š
    let monthIndex = -1;
    let headerLineIndex = -1;

    for (let i = 0; i < lines.length; i++) {
        if (lines[i].includes('éƒ½é“åºœçœŒ') && lines[i].includes('å¸‚å ´å') && (lines[i].includes('æœˆ') || lines[i].includes('12æœˆ'))) {
            headerLineIndex = i;
            break;
        }
    }

    if (headerLineIndex === -1) {
        errorDiv.textContent = "ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œï¼ˆéƒ½é“åºœçœŒ, å¸‚å ´å, æœˆã‚’å«ã‚€è¡Œï¼‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚";
        return;
    }

    const headerParts = lines[headerLineIndex].split(/\t/).map(p => p.trim()).filter(p => p.length > 0);

    for (let i = 0; i < headerParts.length; i++) {
        const part = headerParts[i].replace(/æœˆ/g, ''); 
        if (part === targetMonth) {
            monthIndex = i;
            break;
        }
    }
    
    if (monthIndex === -1) {
        errorDiv.textContent = `å¯¾è±¡æœˆï¼ˆ${targetMonth}æœˆï¼‰ãŒãƒ˜ãƒƒãƒ€ãƒ¼ã«è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚`;
        return;
    }
    
    const dataStartIndexInLine = monthIndex; 
    
    // 2. ãƒ‡ãƒ¼ã‚¿è§£æ
    let currentMarketKey = null; // marketMapã®ã‚­ãƒ¼ã¨ã—ã¦ä½¿ç”¨
    let currentPrefName = null;
    let currentMarketName = null;
    let currentMetric = null;

    for (let i = headerLineIndex + 1; i < lines.length; i++) {
        const line = lines[i];
        
        if (line.includes("ãƒšãƒ¼ã‚¸ï¼š") || line.includes("ã€Š") || line.includes("å“ç¨®ï¼š") || line.includes("å–å¼•æœˆ")) continue;

        // å¸‚å ´å/ç·åˆè¨ˆã®åˆ‡ã‚Šæ›¿ãˆ
        const isMarketLine = isMarketHeaderLine(line);
        const isTotalLine = line.includes("ç·åˆè¨ˆ") && !line.includes("åˆè¨ˆãƒ»å¹³å‡");

        if (isMarketLine || isTotalLine || line.includes("çœŒåˆè¨ˆ")) {
            if (isTotalLine) {
                currentPrefName = 'ç·åˆè¨ˆ';
                currentMarketName = 'ç·åˆè¨ˆ';
                currentMarketKey = 'ç·åˆè¨ˆ';
            } else {
                const names = extractPrefAndMarket(line);
                currentPrefName = names.prefecture;
                currentMarketName = names.market;
                currentMarketKey = createMarketKey(currentPrefName, currentMarketName);
            }
            
            if (!marketMap[currentMarketKey]) {
                marketMap[currentMarketKey] = { 'é›„': {}, 'é›Œ': {}, 'è¨ˆ': {} };
            }
            currentMetric = null;
            continue;
        }

        if (!currentMarketKey) continue; 

        // æŒ‡æ¨™ï¼ˆãƒ¡ãƒˆãƒªã‚¯ã‚¹ï¼‰ã®åˆ‡ã‚Šæ›¿ãˆæ¤œå‡º
        let metricChanged = false;
        if (line.includes("å–å¼•é ­æ•°")) { currentMetric = "count"; metricChanged = true; }
        else if (line.includes("å¹³å‡ä¾¡æ ¼")) { currentMetric = "price"; metricChanged = true; }
        else if (line.includes("å¹³å‡ä½“é‡")) { currentMetric = "weight"; metricChanged = true; }
        else if (line.includes("å¹³å‡æ—¥é½¢")) { currentMetric = "age"; metricChanged = true; }
        else if (line.includes("ï¼‘ãå˜ä¾¡") || line.includes("1kgå˜ä¾¡")) { currentMetric = "unitPrice"; metricChanged = true; }
        
        if (!currentMetric) continue;

        // ãƒ‡ãƒ¼ã‚¿ã®æŠ½å‡ºãƒ­ã‚¸ãƒƒã‚¯
        const lineParts = line.split(/\t/).map(p => p.trim());
        
        const hasFemale = line.includes("é›Œ");
        const hasMale = line.includes("é›„");
        
        const isCountTotalLine = currentMetric === 'count' && (line.includes("è¨ˆ") || line.includes("åˆè¨ˆ")) && !line.includes("åˆè¨ˆãƒ»å¹³å‡") && !line.includes("å¹³å‡ä¾¡æ ¼") && !line.includes("å¹³å‡ä½“é‡") && !line.includes("å¹³å‡æ—¥é½¢");
        const isMetricAverageLine = currentMetric !== 'count' && (line.includes("è¨ˆ") || line.includes("å¹³å‡")) && !line.includes("åˆè¨ˆãƒ»å¹³å‡") && !line.includes("å¹³å‡ä¾¡æ ¼") && !line.includes("å¹³å‡ä½“é‡") && !line.includes("å¹³å‡æ—¥é½¢");

        if (hasFemale) {
            extractAndStore(lineParts, dataStartIndexInLine, currentMarketKey, 'é›Œ', currentMetric);
        }
        if (hasMale) {
            extractAndStore(lineParts, dataStartIndexInLine, currentMarketKey, 'é›„', currentMetric);
        }
        if (isCountTotalLine || isMetricAverageLine) {
            extractAndStore(lineParts, dataStartIndexInLine, currentMarketKey, 'è¨ˆ', currentMetric);
        }
    }

    // 3. ãƒãƒƒãƒ—ã‹ã‚‰é…åˆ—ã¸å¤‰æ›
    Object.keys(marketMap).forEach(mKey => {
        // çœŒåˆè¨ˆã®è¡Œã‚’é™¤å¤–
        if (mKey.endsWith('_çœŒåˆè¨ˆ')) return; 
        
        const nameParts = mKey === 'ç·åˆè¨ˆ' ? { prefecture: 'ç·åˆè¨ˆ', market: '' } : extractPrefAndMarket(mKey.replace('_', '\t'));
        
        ['é›„', 'é›Œ', 'è¨ˆ'].forEach(g => {
            let obj = { 
                key: mKey,
                prefecture: nameParts.prefecture, 
                market: nameParts.market,         
                genderName: g 
            };
            let hasData = false;
            metricsMap.forEach(m => {
                const v = marketMap[mKey][g][m.key];
                // ã™ã¹ã¦ã®é …ç›®ã§å®Ÿæ•°ã‚’æ ¼ç´
                obj[m.key] = v !== undefined ? v : null;
                // scoreã‚­ãƒ¼ã«ã‚‚å®Ÿæ•°ã‚’æ ¼ç´ï¼ˆè¡¨ç¤º/ã‚½ãƒ¼ãƒˆç”¨ï¼‰
                obj[`${m.key}Score`] = v !== undefined ? v : null; 
                
                if (v !== undefined && v !== null && v !== 0) hasData = true;
            });
            
            if (hasData || mKey === 'ç·åˆè¨ˆ') {
                parsedDataByGender[g].push(obj);
            }
        });
    });
    
    // ãƒ‡ãƒ¼ã‚¿ãŒãªã„æ€§åˆ¥ã¯ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
    ['é›„', 'é›Œ', 'è¨ˆ'].forEach(g => {
        parsedDataByGender[g] = parsedDataByGender[g].filter(row => 
            row.key === 'ç·åˆè¨ˆ' || metricsMap.some(m => row[m.key] !== null && row[m.key] !== 0)
        );
    });

    if (parsedDataByGender['è¨ˆ'].length === 0 && parsedDataByGender['é›„'].length === 0) {
        errorDiv.textContent = "æœ‰åŠ¹ãªå¸‚å ´ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚";
        return;
    }

    renderTables();
}

function formatScoreValue(score, key) {
    if (score === undefined || score === null) return `-`;
    
    let num;
    if (key === 'count' || key === 'age') {
        num = Math.round(parseFloat(score));
    } else {
        num = parseFloat(score);
        // ä¾¡æ ¼ã€ä½“é‡ã€å˜ä¾¡ã¯å°æ•°ç‚¹ä»¥ä¸‹ã‚’å››æ¨äº”å…¥ã—ã¦1æ¡è¡¨ç¤º
        num = Math.round(num * 10) / 10; 
    }
    
    if (isNaN(num)) return `-`;

    let formattedValue;
    if (key === 'price' || key === 'unitPrice' || key === 'count') {
        // å¤§ããªæ•°å€¤ã¯ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Š
        formattedValue = num.toLocaleString();
    } else {
        // å°ã•ãªæ•°å€¤ï¼ˆä½“é‡ã€æ—¥é½¢ï¼‰ã¯ãã®ã¾ã¾
        formattedValue = num.toString();
    }
    
    // å˜ä½ã‚’å‰Šé™¤ã—ãŸãŸã‚ã€ç´”ç²‹ãªæ•°å€¤ã®ã¿ã‚’è¿”ã™
    return `<span class="data-value">${formattedValue}</span>`;
}


function sortTable(gender, key) {
    const data = parsedDataByGender[gender].filter(row => row.key !== 'ç·åˆè¨ˆ');
    const totalRow = parsedDataByGender[gender].find(row => row.key === 'ç·åˆè¨ˆ');

    if (sortState[gender].key === key) {
        sortState[gender].dir = sortState[gender].dir === 'asc' ? 'desc' : 'asc';
    } else {
        sortState[gender].key = key;
        
        // å–å¼•é ­æ•°('count')ã¯åˆæœŸã‚½ãƒ¼ãƒˆã‚’ã€Œé ­æ•°ãŒå°‘ãªã„é †ï¼ˆæ˜‡é †ï¼‰ã€
        // ãã®ä»–ã¯åˆæœŸã‚½ãƒ¼ãƒˆã‚’ã€Œæ•°å€¤ãŒå¤§ãã„é †ï¼ˆé™é †ï¼‰ã€
        if (key === 'prefecture' || key === 'market' || key === 'count') {
            sortState[gender].dir = 'asc';
        } else {
            sortState[gender].dir = 'desc'; 
        }
    }
    const dir = sortState[gender].dir;

    data.sort((a, b) => {
        if (key === 'prefecture' || key === 'market') {
            const comp = a[key].localeCompare(b[key], 'ja');
            return dir === 'asc' ? comp : -comp;
        }
        
        const sortKey = `${key}Score`; 
        const valA = a[sortKey];
        const valB = b[sortKey];

        const isInvalidA = (valA === null || valA === undefined);
        const isInvalidB = (valB === null || valB === undefined);

        if (isInvalidA && isInvalidB) return 0;
        if (isInvalidA) return 1; 
        if (isInvalidB) return -1; 

        // æ•°å€¤æ¯”è¼ƒ
        return dir === 'asc' ? valA - valB : valB - valA;
    });

    parsedDataByGender[gender] = totalRow ? [...data, totalRow] : data;
    renderTables();
}


function renderTables() {
    const container = document.getElementById('resultArea');
    container.innerHTML = "";
    
    ['é›„', 'é›Œ', 'è¨ˆ'].forEach(g => {
        const data = parsedDataByGender[g];
        if (data.length === 0) return;

        const section = document.createElement('div');
        section.className = 'gender-section';
        
        let title = `ã€${g}ã€‘ å¸‚å ´ãƒ‡ãƒ¼ã‚¿ä¸€è¦§`;
        if (g === 'è¨ˆ') {
             title = `ã€è¨ˆï¼ˆé ­æ•°ï¼‰/å¹³å‡ï¼ˆä¾¡æ ¼ãªã©ï¼‰ã€‘ å¸‚å ´ãƒ‡ãƒ¼ã‚¿ä¸€è¦§`;
        }
        
        let html = `<h2>${title}</h2>
        <table>
            <thead>
                <tr>
                    <th onclick="sortTable('${g}', 'prefecture')" class="${sortState[g].key === 'prefecture' ? 'sort-' + sortState[g].dir : ''}">éƒ½é“åºœçœŒ</th>
                    <th onclick="sortTable('${g}', 'market')" class="${sortState[g].key === 'market' ? 'sort-' + sortState[g].dir : ''}">å¸‚å ´å</th>`;
        metricsMap.forEach(m => {
            // ãƒ˜ãƒƒãƒ€ãƒ¼ã«ã¯å˜ä½ã‚’è¡¨ç¤ºã—ã¦åŒºåˆ¥ã‚’æ˜ç¢ºã«ã™ã‚‹
            let headerLabel = `${m.label}<br>(${m.unit})`;
            if (g === 'è¨ˆ' && m.key !== 'count') headerLabel = `${m.label}ï¼ˆå¹³å‡ï¼‰<br>(${m.unit})`;
            if (g === 'è¨ˆ' && m.key === 'count') headerLabel = `${m.label}ï¼ˆè¨ˆï¼‰<br>(${m.unit})`;
            
            const isSorted = sortState[g].key === m.key;
            const sortClass = isSorted ? 'sort-' + sortState[g].dir : '';
            html += `<th onclick="sortTable('${g}', '${m.key}')" class="${sortClass}">${headerLabel}</th>`;
        });
        html += `</tr></thead><tbody>`;
        
        const marketData = data.filter(row => row.key !== 'ç·åˆè¨ˆ');
        marketData.forEach(row => {
            html += `<tr>
                        <td class="market-name-col">${row.prefecture}</td>
                        <td class="market-name-col">${row.market}</td>`;
            
            metricsMap.forEach(m => {
                const displayValue = formatScoreValue(row[`${m.key}Score`], m.key);
                html += `<td>${displayValue}</td>`;
            });
            html += `</tr>`;
        });

        const totalRow = data.find(row => row.key === 'ç·åˆè¨ˆ');
        if (totalRow) {
            html += `<tr class="total-row">
                        <td class="market-name-col" colspan="2">ç·åˆè¨ˆ</td>`;
            metricsMap.forEach(m => {
                const displayValue = formatScoreValue(totalRow[`${m.key}Score`], m.key);
                html += `<td>${displayValue}</td>`;
            });
            html += `</tr>`;
        }
        
        html += `</tbody></table>`;
        section.innerHTML = html;
        container.appendChild(section);
    });
}


// åˆæœŸãƒ‡ãƒ¼ã‚¿è¨­å®š
window.onload = function() {
    document.getElementById('dataInput').value = `éƒ½é“åºœçœŒ	å¸‚å ´å	12æœˆ	1æœˆ	2æœˆ	3æœˆ	4æœˆ	5æœˆ	6æœˆ	7æœˆ	8æœˆ	9æœˆ	10æœˆ	11æœˆ	åˆè¨ˆãƒ»å¹³å‡
åŒ—æµ·é“	ãƒ›ã‚¯ãƒ¬ãƒ³å—åŒ—æµ·é“å®¶ç•œå¸‚å ´
	å–å¼•é ­æ•°
	ï¼ˆé ­ï¼‰	é›Œ	785	563	676	625	688	718	690	681	597	604	585	601	7028
		é›„	944	805	902	789	940	1060	929	812	794	881	842	865	9619
		è¨ˆ	1729	1368	1578	1414	1628	1778	1619	1493	1391	1485	1427	1466	16647
	å¹³å‡ä¾¡æ ¼
	ï¼ˆå††ï¼‰	é›Œ	476069	525605	547652	580108	677015	629563	595819	646333	664295	609425	633152	674834	617306
		é›„	600128	656085	683328	722827	805909	745047	747471	777784	778781	751776	753167	793066	747367
		è¨ˆ	543803	602386	625206	659744	751438	698412	682838	717826	729645	693877	703967	744596	692458
	å¹³å‡ä½“é‡
	ï¼ˆKgï¼‰	é›Œ	312.5	316.3	314.1	311.9	317.0	317.5	318.0	314.5	311.8	314.0	314.2	320.0	315.8
		é›„	331.0	336.5	335.0	334.5	342.1	341.0	342.0	340.0	334.0	340.5	339.0	345.0	339.7
		è¨ˆ	322.0	328.0	326.0	324.0	331.0	332.0	331.0	328.0	324.0	330.0	329.0	335.0	329.0
	å¹³å‡æ—¥é½¢
	ï¼ˆæ—¥ï¼‰	é›Œ	301	308	308	306	309	307	304	305	302	306	303	309	306
		é›„	290	296	297	296	298	296	295	292	291	295	293	297	295
		è¨ˆ	295	301	302	301	303	300	299	298	295	299	297	302	300
	ï¼‘ãå˜ä¾¡
	ï¼ˆå††ï¼‰	é›Œ	1526.0	1661.0	1747.0	1864.0	2139.0	1983.0	1876.0	2059.0	2137.0	1939.0	2014.0	2110.0	1959.0
		é›„	1813.0	1953.0	2038.0	2165.0	2355.0	2183.0	2189.0	2285.0	2331.0	2211.0	2220.0	2298.0	2203.0
		è¨ˆ	1687.0	1837.0	1918.0	2037.0	2268.0	2106.0	2061.0	2186.0	2251.0	2105.0	2139.0	2224.0	2105.0
ç·åˆè¨ˆ
	å–å¼•é ­æ•°
	ï¼ˆé ­ï¼‰	é›Œ	7000	6000	5000	4000	3000	2000	1000	500	400	300	200	100	30600
		é›„	9000	8000	7000	6000	5000	4000	3000	2000	1000	900	800	700	47400
		è¨ˆ	16000	14000	12000	10000	8000	6000	4000	2500	1400	1200	1000	800	80000
	å¹³å‡ä¾¡æ ¼
	ï¼ˆå††ï¼‰	é›Œ	450000	500000	520000	550000	600000	650000	700000	750000	800000	850000	900000	950000	718000
		é›„	580000	630000	660000	700000	750000	800000	850000	900000	950000	1000000	1050000	1100000	847500
		è¨ˆ	520000	570000	600000	640000	710000	750000	800000	850000	900000	950000	1000000	1050000	786667
	å¹³å‡ä½“é‡
	ï¼ˆKgï¼‰	é›Œ	300.0	305.0	310.0	315.0	320.0	325.0	330.0	335.0	340.0	345.0	350.0	355.0	330.0
		é›„	320.0	325.0	330.0	335.0	340.0	345.0	350.0	355.0	360.0	365.0	370.0	375.0	350.0
		è¨ˆ	310.0	315.0	320.0	325.0	330.0	335.0	340.0	345.0	350.0	355.0	360.0	365.0	340.0
	å¹³å‡æ—¥é½¢
	ï¼ˆæ—¥ï¼‰	é›Œ	300	300	300	300	300	300	300	300	300	300	300	300	300
		é›„	290	290	290	290	290	290	290	290	290	290	290	290	290
		è¨ˆ	295	295	295	295	295	295	295	295	295	295	295	295	295
	ï¼‘ãå˜ä¾¡
	ï¼ˆå††ï¼‰	é›Œ	1500.0	1600.0	1700.0	1800.0	1900.0	2000.0	2100.0	2200.0	2300.0	2400.0	2500.0	2600.0	2050.0
		é›„	1800.0	1900.0	2000.0	2100.0	2200.0	2300.0	2400.0	2500.0	2600.0	2700.0	2800.0	2900.0	2350.0
		è¨ˆ	1650.0	1750.0	1850.0	1950.0	2050.0	2150.0	2250.0	2350.0	2450.0	2550.0	2650.0	2750.0	2200.0`;
};
</script>
</body>
</html>
