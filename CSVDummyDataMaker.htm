<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>CSV Filter & Grouping Tool</title>
    <style>
        body { font-family: 'Helvetica Neue', Arial, sans-serif; padding: 20px; max-width: 1000px; margin: auto; background: #f9f9f9; }
        textarea { width: 100%; height: 200px; font-family: monospace; margin: 10px 0; border: 1px solid #ccc; padding: 10px; }
        .controls { background: #fff; padding: 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 20px; }
        pre { background: #2d2d2d; color: #ccc; padding: 15px; border-radius: 5px; overflow-x: auto; max-height: 400px; }
        button { padding: 8px 16px; cursor: pointer; border: none; border-radius: 4px; transition: 0.3s; margin-right: 5px; }
        .btn-generate { background: #28a745; color: white; }
        .btn-convert { background: #007bff; color: white; }
        input[type="date"] { padding: 5px; border: 1px solid #ccc; border-radius: 4px; }
    </style>
</head>
<body>

    <h2>CSV 名前主体グループ化・抽出ツール</h2>

    <div class="controls">
        <button class="btn-generate" onclick="generateDummy()">① 800行のダミーデータを生成</button>
        <hr>
        <p>② 抽出条件： 
            <input type="date" id="startDate" value="2026-01-01"> 以降
            <button class="btn-convert" onclick="convert()">③ 抽出してJSON変換</button>
        </p>
    </div>

    <textarea id="csvInput" placeholder="ここにCSVデータが表示されます"></textarea>

    <h3>出力結果 (JSON):</h3>
    <pre id="jsonOutput">変換ボタンを押すとここに結果が表示されます</pre>

    <script>
        // 800行のダミーデータを生成する関数
        function generateDummy() {
            const names = ["田中", "佐藤", "鈴木", "高橋", "伊藤", "渡辺", "山本", "中村"];
            const items = ["打合せ", "資料作成", "システム開発", "顧客対応", "事務作業"];
            const contents = ["定例MTG", "見積書作成", "バグ修正", "電話応対", "経費精算", "コードレビュー"];
            
            let csv = "";
            let startDate = new Date(2026, 0, 1); // 2026年1月1日から

            for (let i = 0; i < 800; i++) {
                // 日付を少しずつ進める
                let d = new Date(startDate);
                d.setDate(d.getDate() + Math.floor(i / 10)); 
                let dateStr = d.toISOString().split('T')[0];

                let name = names[Math.floor(Math.random() * names.length)];
                let item = items[Math.floor(Math.random() * items.length)];
                let content = contents[Math.floor(Math.random() * contents.length)];

                csv += `${dateStr},${name},${item},${content}\n`;
            }
            document.getElementById('csvInput').value = csv.trim();
        }

        // CSVをフィルタリングして名前主体のJSONに変換する関数
        function convert() {
            const input = document.getElementById('csvInput').value.trim();
            const minDate = document.getElementById('startDate').value;
            if (!input) return;

            const lines = input.split('\n');
            const result = {};

            lines.forEach(line => {
                const cols = line.split(',');
                if (cols.length < 4) return;

                const [date, name, item, content] = cols.map(s => s.trim());

                // 日付条件でフィルタリング
                if (date >= minDate) {
                    if (!result[name]) {
                        result[name] = [];
                    }
                    result[name].push({
                        "日付": date,
                        "項目": item,
                        "内容": content
                    });
                }
            });

            document.getElementById('jsonOutput').textContent = JSON.stringify(result, null, 2);
        }
    </script>
</body>
</html>