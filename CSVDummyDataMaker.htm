<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>CSV Data Generator</title>
    <style>
        body { font-family: 'Helvetica Neue', Arial, sans-serif; padding: 20px; max-width: 1000px; margin: auto; background: #f9f9f9; }
        textarea { width: 100%; height: 200px; font-family: monospace; margin: 10px 0; border: 1px solid #ccc; padding: 10px; }
        .controls { background: #fff; padding: 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 20px; }
        pre { background: #2d2d2d; color: #ccc; padding: 15px; border-radius: 5px; overflow-x: auto; max-height: 400px; }
        button { padding: 8px 16px; cursor: pointer; border: none; border-radius: 4px; transition: 0.3s; margin-right: 5px; }
        .btn-generate { background: #28a745; color: white; }
        .btn-convert { background: #007bff; color: white; }
        input[type="date"], input[type="number"] { padding: 5px; border: 1px solid #ccc; border-radius: 4px; }
        .input-group { margin-bottom: 10px; }
        .label-tag { background: #eee; padding: 2px 6px; border-radius: 4px; font-size: 0.9em; font-weight: bold; }
    </style>
</head>
<body>

    <h2>CSV データ生成・グループ化ツール</h2>

    <div class="controls">
        <div class="input-group">
            <span class="label-tag">作成条件</span>
            開始日: <input type="date" id="startDate" value="2025-01-01"> 〜 
            本日まで、計 <input type="number" id="rowCount" value="800" min="1" style="width: 80px;"> 行
            <button class="btn-generate" onclick="generateDummy()">① データを生成</button>
        </div>
        <hr>
        <div class="input-group">
            <button class="btn-convert" onclick="convert()">② 名前ごとにグループ化(JSON)</button>
        </div>
    </div>

    <textarea id="csvInput" placeholder="ここにCSVデータが生成されます"></textarea>

    <h3>出力結果 (JSON):</h3>
    <pre id="jsonOutput">変換ボタンを押すと結果が表示されます</pre>

    <script>
        // 日付を YYYY/MM/DD 形式にするヘルパー関数
        function formatDate(date) {
            const y = date.getFullYear();
            const m = String(date.getMonth() + 1).padStart(2, '0');
            const d = String(date.getDate()).padStart(2, '0');
            return `${y}/${m}/${day = d}`;
        }

        function generateDummy() {
            const count = parseInt(document.getElementById('rowCount').value) || 100;
            const startStr = document.getElementById('startDate').value;
            const startDate = new Date(startStr);
            const endDate = new Date(); 
            
            const timeDiff = endDate.getTime() - startDate.getTime();
            
            if (timeDiff < 0) {
                alert("開始日は本日より前の日付を選択してください。");
                return;
            }

            const names = ["田中", "佐藤", "鈴木", "高橋", "伊藤", "渡辺", "山本", "中村"];
            const items = ["打合せ", "資料作成", "システム開発", "顧客対応", "事務作業"];
            const contents = ["定例MTG", "見積書作成", "バグ修正", "電話応対", "経費精算", "コードレビュー"];
            
            let csv = "";

            for (let i = 0; i < count; i++) {
                let currentTimestamp = startDate.getTime() + (timeDiff * (i / count));
                let d = new Date(currentTimestamp);
                
                // YYYY/MM/DD 形式で生成
                let y = d.getFullYear();
                let m = String(d.getMonth() + 1).padStart(2, '0');
                let day = String(d.getDate()).padStart(2, '0');
                let dateStr = `${y}/${m}/${day}`;

                let name = names[Math.floor(Math.random() * names.length)];
                let item = items[Math.floor(Math.random() * items.length)];
                let content = contents[Math.floor(Math.random() * contents.length)];

                csv += `${dateStr},${name},${item},${content}\n`;
            }
            document.getElementById('csvInput').value = csv.trim();
        }

        function convert() {
            const input = document.getElementById('csvInput').value.trim();
            if (!input) return;

            const lines = input.split('\n');
            const result = {};

            lines.forEach(line => {
                const cols = line.split(',');
                if (cols.length < 4) return;
                const [date, name, item, content] = cols.map(s => s.trim());

                if (!result[name]) result[name] = [];
                result[name].push({ "日付": date, "項目": item, "内容": content });
            });

            document.getElementById('jsonOutput').textContent = JSON.stringify(result, null, 2);
        }
    </script>
</body>
</html>